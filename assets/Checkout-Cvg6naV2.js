import{m as K,b as q,r,j as e,C as J,n as $,R as w,e as p,F as t,B as Q,o as V}from"./index-_JLlfX1p.js";import{C as o,f as u}from"./format-CqrGYAHp.js";import{L as B}from"./ListGroup-BdMkmBTg.js";const M="checkout_form_state",W=["fullName","phone","addressLine","city","postalCode"],P={fullName:"",phone:"",addressLine:"",city:"",postalCode:"",shippingNote:""},S=[{id:"bank_transfer",label:"Transfer Bank",description:"Pembayaran via ATM / mBanking. Diproses dalam 1x24 jam.",fee:0},{id:"ewallet",label:"E-Wallet",description:"OVO, GoPay, Dana, ShopeePay. Diskon 2% otomatis.",discountPercentage:.02},{id:"credit_card",label:"Kartu Kredit / Debit",description:"Visa, Mastercard. Biaya layanan 1.5%.",fee:1.5}],U=()=>{const k=K(),C=q(),[v,L]=r.useState(!1),[l,g]=r.useState({}),[x,F]=r.useState("standard"),[b,E]=r.useState("bank_transfer"),[i,T]=r.useState(()=>{if(typeof window>"u")return P;try{const a=JSON.parse(localStorage.getItem(M));if(a&&typeof a=="object")return{...P,...a}}catch{}return P}),n=r.useMemo(()=>{var a,s,d;if((s=(a=k.state)==null?void 0:a.groups)!=null&&s.length)return k.state;try{const c=JSON.parse(localStorage.getItem("checkout_payload"));if((d=c==null?void 0:c.groups)!=null&&d.length)return c}catch{}return null},[k.state]);if(r.useEffect(()=>{n||C("/cart",{replace:!0})},[n,C]),r.useEffect(()=>{typeof window>"u"||localStorage.setItem(M,JSON.stringify(i))},[i]),r.useEffect(()=>{n&&n.summary.shipping===0&&x==="standard"&&F("pickup")},[n,x]),!n)return null;const N=r.useMemo(()=>{const a=n.summary.shipping??0,s=a>0?a:4.5;return[{id:"standard",label:"Reguler (2-5 hari)",description:"JNE / SiCepat reguler. Estimasi tiba 2-5 hari kerja.",fee:s},{id:"express",label:"Kilat (1-2 hari)",description:"Pengiriman prioritas dengan asuransi penuh.",fee:s+5},{id:"pickup",label:"Ambil di toko",description:"Ambil langsung di warehouse kami tanpa ongkir.",fee:0}]},[n.summary.shipping]),j=r.useMemo(()=>N.find(a=>a.id===x)??N[0],[x,N]),m=r.useMemo(()=>S.find(a=>a.id===b)??S[0],[b]),h=r.useMemo(()=>{const a=n.summary.discountedTotal,s=n.summary.promoDiscount,d=(j==null?void 0:j.fee)??0,c=(m==null?void 0:m.fee)??0,y=m!=null&&m.discountPercentage?a*m.discountPercentage:0,A=Math.max(0,a+d+c-s-y);return{baseSubtotal:a,basePromoDiscount:s,shippingFee:d,paymentFee:c,paymentDiscount:y,finalTotal:A}},[n.summary,m,j]),I=r.useMemo(()=>W.every(a=>{const s=i[a];return typeof s=="string"&&s.trim().length>0}),[i]),D=I&&!!j&&!!m,f=a=>{const{name:s,value:d}=a.target;T(c=>({...c,[s]:d})),g(c=>{if(!c[s])return c;const y={...c};return delete y[s],y})},O=a=>{F(a.target.value),g(s=>{if(!s.shippingMethod)return s;const d={...s};return delete d.shippingMethod,d})},R=a=>{E(a.target.value),g(s=>{if(!s.paymentMethod)return s;const d={...s};return delete d.paymentMethod,d})},_=r.useCallback(()=>{const a={};i.fullName.trim()||(a.fullName="Nama penerima wajib diisi.");const s=i.phone.trim();s?/^[+0-9][0-9\s-]{7,14}$/.test(s)||(a.phone="Gunakan 8-15 digit angka (boleh diawali +62)."):a.phone="Nomor telepon wajib diisi.",i.addressLine.trim()||(a.addressLine="Alamat lengkap belum diisi."),i.city.trim()||(a.city="Kota/kecamatan wajib diisi.");const d=i.postalCode.trim();return d?/^[0-9]{5}$/u.test(d)||(a.postalCode="Kode pos harus 5 digit angka."):a.postalCode="Kode pos wajib diisi.",x||(a.shippingMethod="Pilih salah satu metode pengiriman."),b||(a.paymentMethod="Pilih metode pembayaran."),a},[i,b,x]),G=()=>{const a=_();if(Object.keys(a).length>0){g(a);return}V(),localStorage.removeItem("checkout_payload"),localStorage.removeItem(M),L(!0),setTimeout(()=>{C("/",{replace:!0})},2500)};return e.jsxs(J,{className:"py-5",children:[v&&e.jsx("div",{className:"mb-4",children:e.jsx(o,{className:"border-0 shadow-sm success-popup",children:e.jsxs(o.Body,{className:"text-center py-5",children:[e.jsx($,{className:"display-5 mb-3 text-success"}),e.jsx("h2",{className:"h4 fw-bold mb-2",children:"Pembayaran Berhasil!"}),e.jsx("p",{className:"text-muted mb-0",children:"Terima kasih sudah berbelanja. Pesananmu sedang kami proses."})]})})}),e.jsx(w,{className:"mb-4",children:e.jsxs(p,{children:[e.jsx("h1",{className:"h3 fw-bold",children:"Checkout"}),e.jsxs("p",{className:"text-muted mb-0",children:["Menyelesaikan ",n.summary.items," produk (",n.summary.quantity," pcs) dari"," ",n.groups.length," toko berbeda."]})]})}),e.jsxs(w,{className:"g-4",children:[e.jsxs(p,{xl:8,className:"d-flex flex-column gap-4",children:[e.jsx(o,{className:"border-0 shadow-sm",children:e.jsxs(o.Body,{children:[e.jsx("h5",{className:"fw-semibold mb-3",children:"Alamat Pengiriman"}),e.jsxs(w,{className:"g-3",children:[e.jsx(p,{lg:6,children:e.jsxs(t.Group,{controlId:"checkout-full-name",children:[e.jsx(t.Label,{children:"Nama penerima"}),e.jsx(t.Control,{type:"text",name:"fullName",placeholder:"Contoh: Andi Pratama",value:i.fullName,onChange:f,isInvalid:!!l.fullName,autoComplete:"name",required:!0}),e.jsx(t.Control.Feedback,{type:"invalid",children:l.fullName})]})}),e.jsx(p,{lg:6,children:e.jsxs(t.Group,{controlId:"checkout-phone",children:[e.jsx(t.Label,{children:"Nomor telepon"}),e.jsx(t.Control,{type:"tel",name:"phone",placeholder:"+62 812 3456 7890",value:i.phone,onChange:f,isInvalid:!!l.phone,autoComplete:"tel",required:!0}),e.jsx(t.Control.Feedback,{type:"invalid",children:l.phone})]})}),e.jsx(p,{xs:12,children:e.jsxs(t.Group,{controlId:"checkout-address",children:[e.jsx(t.Label,{children:"Alamat lengkap"}),e.jsx(t.Control,{as:"textarea",name:"addressLine",rows:3,placeholder:"Jalan, nomor rumah, RT/RW",value:i.addressLine,onChange:f,isInvalid:!!l.addressLine,autoComplete:"street-address",required:!0}),e.jsx(t.Control.Feedback,{type:"invalid",children:l.addressLine})]})}),e.jsx(p,{lg:6,children:e.jsxs(t.Group,{controlId:"checkout-city",children:[e.jsx(t.Label,{children:"Kota / Kecamatan"}),e.jsx(t.Control,{type:"text",name:"city",placeholder:"Contoh: Medan",value:i.city,onChange:f,isInvalid:!!l.city,autoComplete:"address-level2",required:!0}),e.jsx(t.Control.Feedback,{type:"invalid",children:l.city})]})}),e.jsx(p,{lg:6,children:e.jsxs(t.Group,{controlId:"checkout-postal",children:[e.jsx(t.Label,{children:"Kode pos"}),e.jsx(t.Control,{type:"text",name:"postalCode",placeholder:"Kode pos",value:i.postalCode,onChange:f,isInvalid:!!l.postalCode,autoComplete:"postal-code",required:!0}),e.jsx(t.Control.Feedback,{type:"invalid",children:l.postalCode})]})}),e.jsx(p,{xs:12,children:e.jsxs(t.Group,{controlId:"checkout-note",children:[e.jsx(t.Label,{children:"Catatan pengiriman (opsional)"}),e.jsx(t.Control,{as:"textarea",rows:2,name:"shippingNote",placeholder:"Contoh: harap hubungi sebelum pengantaran",value:i.shippingNote,onChange:f,maxLength:200}),e.jsx(t.Text,{muted:!0,children:"Maksimal 200 karakter."})]})})]})]})}),e.jsx(o,{className:"border-0 shadow-sm",children:e.jsxs(o.Body,{className:"d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"fw-semibold mb-1",children:"Metode Pengiriman"}),e.jsx("p",{className:"text-muted small mb-0",children:"Pilih jasa kirim yang sesuai dengan kebutuhanmu."})]}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[N.map(a=>e.jsx(t.Check,{type:"radio",name:"shippingMethod",id:`shipping-${a.id}`,value:a.id,label:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-semibold",children:[a.label," - ",a.fee===0?"Gratis":u(a.fee)]}),e.jsx("span",{className:"text-muted small",children:a.description})]}),checked:x===a.id,onChange:O,isInvalid:!!l.shippingMethod},a.id)),l.shippingMethod&&e.jsx("div",{className:"invalid-feedback d-block",children:l.shippingMethod})]})]})}),e.jsx(o,{className:"border-0 shadow-sm",children:e.jsxs(o.Body,{className:"d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"fw-semibold mb-1",children:"Metode Pembayaran"}),e.jsx("p",{className:"text-muted small mb-0",children:"Pembayaran aman dengan berbagai metode yang tersedia."})]}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[S.map(a=>e.jsx(t.Check,{type:"radio",name:"paymentMethod",id:`payment-${a.id}`,value:a.id,label:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:a.label}),e.jsx("span",{className:"text-muted small",children:a.description})]}),checked:b===a.id,onChange:R,isInvalid:!!l.paymentMethod},a.id)),l.paymentMethod&&e.jsx("div",{className:"invalid-feedback d-block",children:l.paymentMethod})]})]})}),n.groups.map(a=>e.jsxs(o,{className:"border-0 shadow-sm",children:[e.jsxs(o.Header,{className:"bg-white fw-semibold d-flex justify-content-between align-items-center",children:[e.jsx("span",{children:a.shop.name}),e.jsxs("span",{className:"text-muted small",children:[a.items.length," produk - ",a.totals.quantity," pcs"]})]}),e.jsx(B,{variant:"flush",children:a.items.map(s=>e.jsx(B.Item,{className:"py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.title}),e.jsxs("div",{className:"text-muted small",children:["Qty ",s.quantity," - ",s.discount,"% OFF"]}),s.note&&e.jsxs("div",{className:"text-muted small fst-italic mt-1",children:["Catatan: ",s.note]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-semibold text-primary",children:u(s.discountedPrice*s.quantity)}),e.jsx("div",{className:"small text-muted text-decoration-line-through",children:u(s.price*s.quantity)})]})]})},s.productId))}),e.jsxs(o.Footer,{className:"bg-white d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted small",children:"Subtotal"}),e.jsx("span",{className:"fw-semibold",children:u(a.totals.discountedTotal)})]})]},a.shop.id??a.shop.name))]}),e.jsx(p,{xl:4,children:e.jsx(o,{className:"border-0 shadow-sm sticky-top",style:{top:"6rem"},children:e.jsxs(o.Body,{className:"d-flex flex-column gap-3",children:[e.jsx("h5",{className:"fw-semibold mb-0",children:"Ringkasan Pembayaran"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"Subtotal produk"}),e.jsx("span",{children:u(h.baseSubtotal)})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("span",{children:["Ongkir (",j.label,")"]}),e.jsx("span",{children:h.shippingFee===0?"Gratis":u(h.shippingFee)})]}),h.paymentFee>0&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("span",{children:["Biaya layanan (",m.label,")"]}),e.jsx("span",{children:u(h.paymentFee)})]}),e.jsxs("div",{className:"d-flex justify-content-between text-success",children:[e.jsx("span",{children:"Promo"}),e.jsx("span",{children:h.basePromoDiscount>0?`-${u(h.basePromoDiscount)}`:"-"})]}),h.paymentDiscount>0&&e.jsxs("div",{className:"d-flex justify-content-between text-success",children:[e.jsx("span",{children:"Diskon pembayaran"}),e.jsxs("span",{children:["-",u(h.paymentDiscount)]})]}),n.promoMessage&&e.jsx("div",{className:"small text-muted",children:n.promoMessage}),e.jsx(o,{className:"bg-light border-0",children:e.jsxs(o.Body,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-semibold",children:"Total Bayar"}),e.jsx("span",{className:"fs-5 fw-bold text-primary",children:u(h.finalTotal)})]})}),e.jsx(Q,{variant:"primary",size:"lg",onClick:G,disabled:v||!D,children:v?"Memproses...":"Bayar Sekarang"}),!I&&e.jsx("div",{className:"text-muted small",children:"Lengkapi alamat dan kontak untuk mengaktifkan pembayaran."}),e.jsx("div",{className:"text-muted small",children:"Pembayaran aman dan terenkripsi. Dengan menekan tombol di atas, kamu menyetujui syarat & ketentuan DinoMarket."})]})})})]})]})};export{U as default};
